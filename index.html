<!DOCTYPE html>
<html>
<head>
    <title>دردشة Firebase</title>
    <style>
        body { 
            font-family: Arial;
            background: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        #chat-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .message {
            margin: 10px 0;
        }
        #messageInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="auth-container">
        <h2>تسجيل الدخول/إنشاء حساب</h2>
        <input type="text" id="username" placeholder="اسم المستخدم" required>
        <input type="password" id="password" placeholder="كلمة المرور" required>
        <button onclick="signIn()">تسجيل الدخول</button>
        <button onclick="signUp()">إنشاء حساب</button>
    </div>
    
    <div id="chat-container" style="display: none;">
        <h2>الدردشة</h2>
        <div id="messages"></div>
        <input type="text" id="messageInput" placeholder="اكتب رسالتك...">
        <button onclick="sendMessage()">إرسال</button>
    </div>

<script type="module">
    // Firebase Initialization [[1]][[2]]
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDkL37i0-pd885YbCBYOkADYQVQINcswhk",
        authDomain: "messengerapp-58f7a.firebaseapp.com",
        projectId: "messengerapp-58f7a",
        storageBucket: "messengerapp-58f7a.appspot.com",
        messagingSenderId: "46178168523",
        appId: "1:46178168523:web:cba8a71de3d7cc5910f54e"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    function signIn() {
        const email = document.getElementById('username').value + '@app.com';
        const password = document.getElementById('password').value;
        
        signInWithEmailAndPassword(auth, email, password)
            .then(cred => {
                showChatUI();
                listenForMessages();
            })
            .catch(error => alert(error.message));
    }

    function signUp() {
        const email = document.getElementById('username').value + '@app.com';
        const password = document.getElementById('password').value;
        
        createUserWithEmailAndPassword(auth, email, password)
            .then(cred => {
                alert('تم التسجيل بنجاح!');
                showChatUI();
                listenForMessages();
            })
            .catch(error => alert(error.message));
    }

    function sendMessage() {
        const message = document.getElementById('messageInput').value;
        const user = auth.currentUser.email.split('@')[0];
        
        addDoc(collection(db, "messages"), {
            text: message,
            author: user,
            timestamp: new Date()
        })
        .then(() => document.getElementById('messageInput').value = '');
    }

    function listenForMessages() {
        const q = query(collection(db, "messages"), orderBy("timestamp"));
        onSnapshot(q, (querySnapshot) => {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            
            querySnapshot.forEach(doc => {
                const msg = doc.data();
                const div = document.createElement('div');
                div.className = 'message';
                div.innerHTML = `<strong>${msg.author}:</strong> ${msg.text}`;
                messagesDiv.appendChild(div);
            });
        });
    }

    function showChatUI() {
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('chat-container').style.display = 'block';
    }
</script>
</body>
</html>
