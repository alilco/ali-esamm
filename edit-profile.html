<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>تعديل الملف الشخصي</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div class="navbar">
    <button onclick="goBack()">رجوع</button>
    تعديل الملف الشخصي
  </div>

  <div class="main-container">
    <form class="form" onsubmit="updateProfile(event)">
      <label>الصورة الشخصية (رابط):</label>
      <input type="text" id="image" placeholder="ضع رابط الصورة" />

      <label>اسم العرض:</label>
      <input type="text" id="displayName" placeholder="أدخل اسم العرض" />

      <label>نبذة عنك:</label>
      <textarea id="bio" rows="3" placeholder="أكتب نبذة عنك"></textarea>

      <button type="submit">حفظ التعديلات</button>
    </form>
  </div>

  <script>
    const currentUser = localStorage.getItem("currentUser");
    if (!currentUser) window.location.href = "login.html";

    let users = [];

    fetch("users.json")
      .then(res => res.json())
      .then(data => {
        users = data;
        const user = users.find(u => u.username === currentUser);
        if (user) {
          document.getElementById("image").value = user.image || "";
          document.getElementById("displayName").value = user.displayName || "";
          document.getElementById("bio").value = user.bio || "";
        }
      });

    function updateProfile(e) {
      e.preventDefault();
      const image = document.getElementById("image").value;
      const displayName = document.getElementById("displayName").value;
      const bio = document.getElementById("bio").value;

      const userIndex = users.findIndex(u => u.username === currentUser);
      if (userIndex !== -1) {
        users[userIndex].image = image;
        users[userIndex].displayName = displayName;
        users[userIndex].bio = bio;

        // تحديث ملف users.json (هذا الجزء يتم عبر server.js في الواقع)
        fetch('/update-user', {
          method: 'POST',
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(users)
        }).then(() => {
          alert("تم تحديث الملف الشخصي بنجاح!");
          window.location.href = "profile.html";
        });
      }
    }

    function goBack() {
      window.location.href = "profile.html";
    }
  </script>

</body>
</html>
